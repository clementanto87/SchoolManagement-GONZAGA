// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum UserRole {
  ADMIN
  TEACHER
  STUDENT
  PARENT
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

enum FeeStatus {
  PAID
  PENDING
  OVERDUE
  PARTIAL
}

enum ApplicationStatus {
  PENDING
  REVIEWING
  ACCEPTED
  REJECTED
}

enum ContactRequestStatus {
  PENDING
  READ
  REPLIED
}

model ContactRequest {
  id        String   @id @default(uuid())
  name      String
  email     String
  subject   String
  message   String   @db.Text
  
  status    ContactRequestStatus @default(PENDING)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Application {
  id          String   @id @default(uuid())
  firstName   String
  lastName    String
  dob         DateTime
  gender      Gender
  grade       String   // Grade applying for
  
  parentName  String
  parentEmail String
  parentPhone String
  address     String
  
  status      ApplicationStatus @default(PENDING)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model News {
  id          String   @id @default(uuid())
  title       String
  excerpt     String
  content     String   @db.Text
  date        DateTime @default(now())
  author      String?
  imageUrl    String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      UserRole @default(STUDENT)
  firstName String
  lastName  String
  phone     String?
  address   String?
  photo     String?  // URL to profile photo
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  student   Student?
  teacher   Teacher?
  admin     Admin?
  parent    Parent?
  sentMessages Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  createdNotices Notice[]
}

model Student {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id])
  admissionNo String @unique
  rollNo    String?
  grade     String?  // Grade applied for or current
  section   String?  // Section if assigned
  dob       DateTime
  gender    Gender
  bloodGroup String?
  
  classId   String?
  class     Class?   @relation(fields: [classId], references: [id])
  
  parentId  String?
  parent    Parent?  @relation(fields: [parentId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  attendances Attendance[]
  submissions Submission[]
  grades      Grade[]
  fees        Fee[]
}

model Teacher {
  id          String   @id @default(uuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id])
  specialization String?
  qualification String?
  experience  Int?     // Years of experience
  hireDate    DateTime
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  classes     Class[]  @relation("ClassTeacher")
  subjects    Subject[]
  assignments Assignment[]
  timetables  Period[]
}

model Parent {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id])
  occupation String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  students  Student[]
}

model Admin {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id])
  designation String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Class {
  id          String   @id @default(uuid())
  name        String   // e.g., "10"
  section     String   // e.g., "A"
  academicYear String  // e.g., "2023-2024"
  
  classTeacherId String?
  classTeacher   Teacher? @relation("ClassTeacher", fields: [classTeacherId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  students    Student[]
  assignments Assignment[]
  timetable   Timetable[]
}

model Subject {
  id          String   @id @default(uuid())
  name        String
  code        String   @unique
  description String?
  
  teacherId   String?
  teacher     Teacher? @relation(fields: [teacherId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  periods     Period[]
  assignments Assignment[]
  grades      Grade[]
}

model Timetable {
  id        String   @id @default(uuid())
  classId   String
  class     Class    @relation(fields: [classId], references: [id])
  dayOfWeek String   // MONDAY, TUESDAY, etc.
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  periods   Period[]
  
  @@unique([classId, dayOfWeek])
}

model Period {
  id          String    @id @default(uuid())
  timetableId String
  timetable   Timetable @relation(fields: [timetableId], references: [id])
  subjectId   String
  subject     Subject   @relation(fields: [subjectId], references: [id])
  teacherId   String
  teacher     Teacher   @relation(fields: [teacherId], references: [id])
  startTime   String    // e.g., "09:00"
  endTime     String    // e.g., "10:00"
  roomNo      String?
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Attendance {
  id        String           @id @default(uuid())
  studentId String
  student   Student          @relation(fields: [studentId], references: [id])
  date      DateTime
  status    AttendanceStatus
  remarks   String?
  
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  
  @@unique([studentId, date])
}

model Assignment {
  id          String   @id @default(uuid())
  title       String
  description String?
  dueDate     DateTime
  totalMarks  Int
  
  classId     String
  class       Class    @relation(fields: [classId], references: [id])
  subjectId   String
  subject     Subject  @relation(fields: [subjectId], references: [id])
  teacherId   String
  teacher     Teacher  @relation(fields: [teacherId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  submissions Submission[]
}

model Submission {
  id           String    @id @default(uuid())
  assignmentId String
  assignment   Assignment @relation(fields: [assignmentId], references: [id])
  studentId    String
  student      Student   @relation(fields: [studentId], references: [id])
  content      String?   // Link or text
  attachments  String[]
  submittedAt  DateTime  @default(now())
  
  grade        Float?
  feedback     String?
  
  @@unique([assignmentId, studentId])
}

model Exam {
  id          String   @id @default(uuid())
  name        String   // e.g., "Mid-Term Exam"
  startDate   DateTime
  endDate     DateTime
  academicYear String
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  grades      Grade[]
}

model Grade {
  id        String   @id @default(uuid())
  studentId String
  student   Student  @relation(fields: [studentId], references: [id])
  examId    String
  exam      Exam     @relation(fields: [examId], references: [id])
  subjectId String
  subject   Subject  @relation(fields: [subjectId], references: [id])
  
  marksObtained Float
  maxMarks      Float
  remarks       String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([studentId, examId, subjectId])
}

model Fee {
  id          String    @id @default(uuid())
  studentId   String
  student     Student   @relation(fields: [studentId], references: [id])
  title       String    // e.g., "Tuition Fee - Term 1"
  amount      Float
  dueDate     DateTime
  status      FeeStatus @default(PENDING)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  payments    Payment[]
}

model Payment {
  id            String   @id @default(uuid())
  feeId         String
  fee           Fee      @relation(fields: [feeId], references: [id])
  amountPaid    Float
  paymentDate   DateTime @default(now())
  paymentMethod String   // CASH, CARD, ONLINE
  transactionId String?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Notice {
  id        String   @id @default(uuid())
  title     String
  content   String
  audience  String[] // ["ALL", "TEACHERS", "STUDENTS", "PARENTS"]
  isPinned  Boolean  @default(false)
  
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Message {
  id          String   @id @default(uuid())
  senderId    String
  sender      User     @relation("SentMessages", fields: [senderId], references: [id])
  receiverId  String
  receiver    User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  content     String
  isRead      Boolean  @default(false)
  
  createdAt   DateTime @default(now())
}

model Event {
  id          String   @id @default(uuid())
  title       String
  date        DateTime
  time        String
  location    String
  description String
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
